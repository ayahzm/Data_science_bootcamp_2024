<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        #chartdiv {
            width: 100%;
            height: 500px;
        }
    </style>
    <meta charset="UTF-8">
    <title>Articles Updated After Publication</title>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
</head>
<body>

<h2>Enter Coverage</h2>
<form id="coverageForm">
    <label for="coverage">Coverage:</label>
    <input type="text" id="coverage" name="coverage">
    <button type="submit">Get Chart</button>
</form>

<div id="chartdiv"></div>

<script>
    am5.ready(function() {
        // Event listener for the form submission
        document.getElementById('coverageForm').addEventListener('submit', function (e) {
            e.preventDefault();  // Prevent form from submitting the default way

            // Get the coverage input value
            var coverageInput = document.getElementById('coverage').value;

            if (coverageInput) {
                // Fetch data from the Flask endpoint with coverage as input
                fetch(`http://127.0.0.1:5000/articles_by_coverage/${coverageInput}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        const updatedAfterPublicationCount = data.count;
                        const notUpdatedCount = 9991 - updatedAfterPublicationCount;  // Assuming a total of 9991 articles

                        // Clear the previous chart
                        document.getElementById('chartdiv').innerHTML = '';

                        // Create root element
                        var root = am5.Root.new("chartdiv");

                        // Set themes
                        root.setThemes([am5themes_Animated.new(root)]);

                        // Create chart
                        var chart = root.container.children.push(am5percent.PieChart.new(root, {
                            layout: root.verticalLayout
                        }));

                        // Create series
                        var series = chart.series.push(am5percent.PieSeries.new(root, {
                            valueField: "count",
                            categoryField: "category"
                        }));

                        // Set data
                        series.data.setAll([
                            { category: coverageInput, count: updatedAfterPublicationCount },
                            { category: "Other", count: notUpdatedCount }
                        ]);

                        // Customize tooltips to display both percentage and count
                        series.slices.template.set("tooltipText", "{category}: {count} ({value.percent.formatNumber('#.0')}%)");

                        // Animate chart
                        series.appear(1000, 100);
                    })
                    .catch(error => console.error("Fetch error: ", error));
            } else {
                alert("Please enter a coverage value.");
            }
        });
    });
</script>

</body>
</html>
