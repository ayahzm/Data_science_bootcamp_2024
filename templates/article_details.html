{% extends "base_template.html" %}

{% block title %}Article Details{% endblock %}

{% block content %}
    <div style="width: 50%; margin-left: 500px; margin-top: 100px; height:500px;">
        <h1>Article Details</h1>

        <input type="text" id="postIdInput" placeholder="Enter post ID">
        <button id="fetchButton">Fetch Article</button>

        <table id="articlesTable">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Publication Date</th>
                    <th>Word Count</th>
                    <th>Url</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>
{% endblock %}

{% block script %}
<script>
    document.getElementById('fetchButton').addEventListener('click', function() {
        const postId = document.getElementById('postIdInput').value.trim();
        if (!postId) {
            alert('Please enter a post ID.');
            return;
        }

        fetch(`http://127.0.0.1:5000/article_details/${encodeURIComponent(postId)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json(); // Parse JSON from the response
            })
            .then(data => {
                const tableBody = document.querySelector("#articlesTable tbody");
                tableBody.innerHTML = ''; // Clear any existing data

                if (data && !data.error) {
                    const row = document.createElement("tr");

                    const titleCell = document.createElement("td");
                    titleCell.textContent = data.title || 'N/A';
                    row.appendChild(titleCell);

                    const authorCell = document.createElement("td");
                    authorCell.textContent = data.author || 'N/A';
                    row.appendChild(authorCell);

                    const dateCell = document.createElement("td");
                    dateCell.textContent = new Date(data.publication_date).toLocaleDateString() || 'N/A';
                    row.appendChild(dateCell);

                    const wordCountCell = document.createElement("td");
                    wordCountCell.textContent = data.word_count || 'N/A';
                    row.appendChild(wordCountCell);

                    const urlCell = document.createElement("td");
                    urlCell.textContent = data.url || 'N/A';
                    row.appendChild(urlCell);

                    tableBody.appendChild(row);
                } else {
                    tableBody.innerHTML = '<tr><td colspan="5">Article not found.</td></tr>';
                }
            })
            .catch(error => {
                console.error('Error fetching article:', error);
            });
    });
</script>
{% endblock %}
