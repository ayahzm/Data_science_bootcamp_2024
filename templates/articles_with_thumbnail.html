{% extends "base_template.html" %}

{% block title %}Articles Thumbnail Distribution{% endblock %}

{% block content %}
    <div id="chartdiv" style="width: 100%; height: 600px;"></div>
{% endblock %}

{% block script %}
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<script>
    am5.ready(function() {
        fetch('http://127.0.0.1:5000/articles_with_thumbnail')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const withThumbnailCount = data.count;
                const withoutThumbnailCount = 9991 - withThumbnailCount;  // Adjust total as needed

                // Create root element
                var root = am5.Root.new("chartdiv");

                // Set themes
                root.setThemes([am5themes_Animated.new(root)]);

                // Create chart
                var chart = root.container.children.push(am5percent.PieChart.new(root, {
                    layout: root.verticalLayout
                }));

                // Create series
                var series = chart.series.push(am5percent.PieSeries.new(root, {
                    valueField: "count",
                    categoryField: "category"
                }));

                // Set data
                series.data.setAll([
                    { category: "With Thumbnail", count: withThumbnailCount },
                    { category: "Without Thumbnail", count: withoutThumbnailCount }
                ]);

                // Customize tooltips to display both percentage and count
                series.slices.template.set("tooltipText", "{category}: {count} ({value.percent.formatNumber('#.0')}%)");

                // Animate chart
                series.appear(1000, 100);
            })
            .catch(error => console.error("Fetch error: ", error));
    });
</script>
{% endblock %}
